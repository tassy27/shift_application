<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>シフト集約システム 要件サマリー</title>
  <style>
    :root {
      --bg: #f3f6fb;
      --ink: #1a2433;
      --muted: #516073;
      --brand: #0f6cbd;
      --accent: #1f9d7a;
      --line: #d5deea;
      --card: #ffffff;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Yu Gothic UI", "Meiryo", sans-serif;
      color: var(--ink);
      background: var(--bg);
      line-height: 1.6;
    }
    .page {
      width: 210mm;
      min-height: 297mm;
      margin: 0 auto;
      padding: 16mm;
      background: #fff;
      page-break-after: always;
      position: relative;
    }
    .page:last-child { page-break-after: auto; }
    h1, h2, h3 { margin: 0 0 8px; line-height: 1.3; }
    h1 { font-size: 34px; }
    h2 { font-size: 24px; color: #103a66; margin-top: 4px; }
    h3 { font-size: 17px; color: #1a3f66; }
    p { margin: 0 0 8px; }
    .muted { color: var(--muted); }
    .badge {
      display: inline-block;
      background: #e8f1fb;
      color: #0f4f8a;
      border: 1px solid #bfd8f1;
      border-radius: 999px;
      padding: 3px 10px;
      font-size: 12px;
      margin-right: 6px;
    }
    .hero {
      background: linear-gradient(135deg, #edf5ff 0%, #f4fffb 100%);
      border: 1px solid #cfe4f9;
      border-radius: 18px;
      padding: 18px;
      margin-bottom: 14px;
    }
    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    .grid-3 {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    .card {
      border: 1px solid var(--line);
      background: var(--card);
      border-radius: 12px;
      padding: 12px;
    }
    .card h3 { margin-bottom: 6px; }
    .kpi {
      font-size: 28px;
      font-weight: 700;
      color: var(--brand);
      margin: 0;
    }
    .flow {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 8px;
      align-items: stretch;
      margin-top: 8px;
    }
    .step {
      border: 1px solid #c8d9ef;
      border-radius: 12px;
      background: #f8fbff;
      padding: 10px;
      text-align: center;
      font-size: 13px;
      position: relative;
      min-height: 86px;
    }
    .step:not(:last-child)::after {
      content: "→";
      position: absolute;
      right: -10px;
      top: 50%;
      transform: translateY(-50%);
      color: #7a8da6;
      font-weight: 700;
    }
    .chip {
      display: inline-block;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid #c8d9ef;
      color: #1d527f;
      font-size: 11px;
      margin-bottom: 6px;
      background: #fff;
    }
    .table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }
    .table th, .table td {
      border: 1px solid #d8e2ef;
      padding: 6px 8px;
      vertical-align: top;
    }
    .table th {
      background: #f2f7fd;
      text-align: left;
      color: #143e67;
    }
    .stack > * { margin-bottom: 8px; }
    .stack > *:last-child { margin-bottom: 0; }
    .api-box {
      border: 1px solid #cae0f3;
      border-left: 4px solid var(--brand);
      border-radius: 10px;
      padding: 8px 10px;
      background: #f8fbff;
      margin-bottom: 8px;
    }
    .api-box code { font-size: 12px; }
    .footer {
      position: absolute;
      bottom: 10mm;
      left: 16mm;
      right: 16mm;
      border-top: 1px solid #d8e3f0;
      padding-top: 6px;
      font-size: 11px;
      color: #647489;
      display: flex;
      justify-content: space-between;
    }
    .illustration {
      border: 1px solid #d4e0ef;
      border-radius: 12px;
      padding: 8px;
      background: #fbfdff;
    }
    @media print {
      body { background: #fff; }
      .page { margin: 0; width: auto; min-height: auto; }
    }
  </style>
</head>
<body>
  <section class="page">
    <div class="hero">
      <span class="badge">可視化資料</span>
      <span class="badge">要件定義 + ER + API</span>
      <h1>シフト集約システム<br>統合サマリー</h1>
      <p class="muted">対象: 社員の月次シフト希望提出 / 管理者の集約管理 / CSV差分出力</p>
    </div>

    <div class="grid-3">
      <div class="card">
        <h3>入力ルール</h3>
        <p class="kpi">1回</p>
        <p>1社員 × 1対象月で提出は1回のみ</p>
      </div>
      <div class="card">
        <h3>認証方式</h3>
        <p class="kpi">社員選択</p>
        <p>社員名プルダウン + メール入力でログイン</p>
      </div>
      <div class="card">
        <h3>出力先</h3>
        <p class="kpi">CSV</p>
        <p>DB差分をCSVへ自動出力</p>
      </div>
    </div>

    <div class="grid-2" style="margin-top:12px;">
      <div class="card stack">
        <h3>スコープ</h3>
        <p>1. 社員: 対象月の希望提出（プルダウン選択）</p>
        <p>2. 管理者: 集約確認、未提出確認、社員マスタ管理</p>
        <p>3. システム: 認証、保存、同期、監査ログ</p>
      </div>
      <div class="illustration">
        <svg viewBox="0 0 520 210" width="100%" height="180" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#e9f4ff"/>
              <stop offset="100%" stop-color="#ecfff7"/>
            </linearGradient>
          </defs>
          <rect x="4" y="4" width="512" height="202" rx="14" fill="url(#g1)" stroke="#c8dbef"/>
          <rect x="20" y="64" width="120" height="78" rx="10" fill="#fff" stroke="#9ec3e8"/>
          <text x="80" y="98" text-anchor="middle" font-size="13" fill="#1c4e7a">社員</text>
          <text x="80" y="118" text-anchor="middle" font-size="11" fill="#56708d">希望入力</text>
          <rect x="198" y="43" width="130" height="120" rx="10" fill="#fff" stroke="#8acfb7"/>
          <text x="263" y="78" text-anchor="middle" font-size="13" fill="#1d6652">シフト集約</text>
          <text x="263" y="98" text-anchor="middle" font-size="11" fill="#56708d">DB保存</text>
          <text x="263" y="116" text-anchor="middle" font-size="11" fill="#56708d">重複防止</text>
          <rect x="386" y="64" width="120" height="78" rx="10" fill="#fff" stroke="#9ec3e8"/>
          <text x="446" y="98" text-anchor="middle" font-size="13" fill="#1c4e7a">管理者</text>
          <text x="446" y="118" text-anchor="middle" font-size="11" fill="#56708d">CSV確認</text>
          <line x1="140" y1="103" x2="198" y2="103" stroke="#7896b7" stroke-width="2"/>
          <polygon points="198,103 188,98 188,108" fill="#7896b7"/>
          <line x1="328" y1="103" x2="386" y2="103" stroke="#7896b7" stroke-width="2"/>
          <polygon points="386,103 376,98 376,108" fill="#7896b7"/>
        </svg>
      </div>
    </div>
    <div class="footer"><span>Shift Aggregation Visual Spec</span><span>1 / 3</span></div>
  </section>

  <section class="page">
    <h2>画面遷移とデータモデル</h2>
    <div class="card">
      <h3>画面遷移（主要フロー）</h3>
      <div class="flow">
        <div class="step"><span class="chip">S01</span><br>社員選択ログイン</div>
        <div class="step"><span class="chip">S03</span><br>対象月選択<br>社員プルダウン</div>
        <div class="step"><span class="chip">S03</span><br>日別希望入力</div>
        <div class="step"><span class="chip">S04</span><br>提出完了</div>
        <div class="step"><span class="chip">S05</span><br>提出済み確認</div>
      </div>
      <p class="muted" style="margin-top:8px;">管理者は `A01` ダッシュボードから `A02 集約一覧 / A03 未提出一覧 / A04 社員マスタ / A05 同期履歴` を操作。</p>
    </div>

    <div class="grid-2" style="margin-top:12px;">
      <div class="card">
        <h3>ERサマリー（コアテーブル）</h3>
        <table class="table">
          <thead><tr><th>テーブル</th><th>役割</th><th>重要ポイント</th></tr></thead>
          <tbody>
            <tr><td>users</td><td>ログイン主体</td><td>社員選択ログインのセッション管理</td></tr>
            <tr><td>employees</td><td>社員マスタ</td><td>在籍/無効化を管理</td></tr>
            <tr><td>shift_months</td><td>対象月</td><td>`YYYY-MM` を一意管理</td></tr>
            <tr><td>shift_submissions</td><td>提出ヘッダ</td><td><b>UNIQUE(employee_id, shift_month_id)</b></td></tr>
            <tr><td>shift_submission_details</td><td>日別明細</td><td>希望可否（可/不可/調整可）</td></tr>
            <tr><td>sync_jobs</td><td>同期ジョブ</td><td>自動/手動/再実行の履歴</td></tr>
            <tr><td>audit_logs</td><td>監査証跡</td><td>提出・同期・マスタ更新を記録</td></tr>
          </tbody>
        </table>
      </div>
      <div class="illustration">
        <svg viewBox="0 0 520 360" width="100%" height="340" xmlns="http://www.w3.org/2000/svg">
          <rect x="22" y="18" width="136" height="68" rx="10" fill="#f5fbff" stroke="#8ab8e5"/>
          <text x="90" y="43" text-anchor="middle" font-size="12" fill="#1d4f7d">users</text>
          <text x="90" y="62" text-anchor="middle" font-size="10" fill="#5a7590">id, email</text>
          <rect x="202" y="18" width="140" height="68" rx="10" fill="#f5fbff" stroke="#8ab8e5"/>
          <text x="272" y="43" text-anchor="middle" font-size="12" fill="#1d4f7d">employees</text>
          <text x="272" y="62" text-anchor="middle" font-size="10" fill="#5a7590">id, employee_code</text>
          <rect x="362" y="18" width="136" height="68" rx="10" fill="#f5fbff" stroke="#8ab8e5"/>
          <text x="430" y="43" text-anchor="middle" font-size="12" fill="#1d4f7d">shift_months</text>
          <text x="430" y="62" text-anchor="middle" font-size="10" fill="#5a7590">id, year_month</text>

          <rect x="146" y="130" width="224" height="88" rx="12" fill="#eefaf6" stroke="#7cc8ad" stroke-width="1.3"/>
          <text x="258" y="160" text-anchor="middle" font-size="13" fill="#1e5d4a">shift_submissions</text>
          <text x="258" y="180" text-anchor="middle" font-size="10.5" fill="#496f63">UNIQUE(employee_id, shift_month_id)</text>
          <text x="258" y="198" text-anchor="middle" font-size="10.5" fill="#496f63">submitted_by_user_id</text>

          <rect x="146" y="258" width="160" height="70" rx="10" fill="#f9fbff" stroke="#b2c9e6"/>
          <text x="226" y="284" text-anchor="middle" font-size="12" fill="#1d4f7d">shift_submission_details</text>
          <text x="226" y="303" text-anchor="middle" font-size="10" fill="#5a7590">target_date, availability</text>

          <rect x="330" y="258" width="168" height="70" rx="10" fill="#f9fbff" stroke="#b2c9e6"/>
          <text x="414" y="284" text-anchor="middle" font-size="12" fill="#1d4f7d">sync_jobs / items</text>
          <text x="414" y="303" text-anchor="middle" font-size="10" fill="#5a7590">status, trigger_type</text>

          <line x1="90" y1="86" x2="205" y2="130" stroke="#8ca4bf" />
          <line x1="272" y1="86" x2="258" y2="130" stroke="#8ca4bf" />
          <line x1="430" y1="86" x2="312" y2="130" stroke="#8ca4bf" />
          <line x1="226" y1="218" x2="226" y2="258" stroke="#8ca4bf" />
          <line x1="312" y1="218" x2="390" y2="258" stroke="#8ca4bf" />
        </svg>
      </div>
    </div>
    <div class="footer"><span>Shift Aggregation Visual Spec</span><span>2 / 3</span></div>
  </section>

  <section class="page">
    <h2>API一覧と連携イメージ</h2>
    <div class="grid-2">
      <div class="card">
        <h3>APIグループ</h3>
        <div class="api-box"><b>認証</b><br><code>GET /public/employees/active</code><br><code>POST /auth/employee-login</code><br><code>GET /me</code></div>
        <div class="api-box"><b>社員提出</b><br><code>GET /shift-months/open</code><br><code>GET /employees/active</code><br><code>POST /shift-submissions</code></div>
        <div class="api-box"><b>管理者</b><br><code>GET /admin/shift-submissions/:yearMonth</code><br><code>GET /admin/unsubmitted/:yearMonth</code><br><code>PATCH /admin/shift-submissions/by-id/:id</code></div>
        <div class="api-box"><b>CSV出力</b><br><code>POST /admin/sync-jobs</code><br><code>GET /admin/sync-jobs</code><br><code>GET /admin/sync-jobs/:id</code></div>
      </div>
      <div class="illustration">
        <svg viewBox="0 0 520 320" width="100%" height="300" xmlns="http://www.w3.org/2000/svg">
          <rect x="20" y="40" width="120" height="66" rx="10" fill="#f4f9ff" stroke="#92bce5"/>
          <text x="80" y="67" text-anchor="middle" font-size="12" fill="#1f527f">社員UI</text>
          <text x="80" y="85" text-anchor="middle" font-size="10" fill="#617b93">提出API呼出</text>

          <rect x="198" y="18" width="132" height="66" rx="10" fill="#f4f9ff" stroke="#92bce5"/>
          <text x="264" y="45" text-anchor="middle" font-size="12" fill="#1f527f">社員選択ログイン</text>
          <text x="264" y="63" text-anchor="middle" font-size="10" fill="#617b93">メール更新 + セッション</text>

          <rect x="182" y="122" width="164" height="80" rx="12" fill="#ecfaf5" stroke="#84c8b0"/>
          <text x="264" y="154" text-anchor="middle" font-size="13" fill="#1d634f">アプリAPI</text>
          <text x="264" y="174" text-anchor="middle" font-size="10.5" fill="#5b7a6f">バリデーション / 保存 / CSV差分出力</text>

          <rect x="20" y="216" width="120" height="66" rx="10" fill="#f4f9ff" stroke="#92bce5"/>
          <text x="80" y="243" text-anchor="middle" font-size="12" fill="#1f527f">管理者UI</text>
          <text x="80" y="261" text-anchor="middle" font-size="10" fill="#617b93">集約確認</text>

          <rect x="388" y="122" width="112" height="80" rx="10" fill="#f4f9ff" stroke="#92bce5"/>
          <text x="444" y="154" text-anchor="middle" font-size="12" fill="#1f527f">DB</text>
          <text x="444" y="174" text-anchor="middle" font-size="10" fill="#617b93">提出/監査</text>

          <rect x="388" y="226" width="112" height="66" rx="10" fill="#f4f9ff" stroke="#92bce5"/>
          <text x="444" y="253" text-anchor="middle" font-size="12" fill="#1f527f">CSV Export</text>
          <text x="444" y="271" text-anchor="middle" font-size="10" fill="#617b93">差分出力</text>

          <line x1="140" y1="73" x2="182" y2="53" stroke="#7f99b5" stroke-width="1.8"/>
          <polygon points="182,53 172,52 176,60" fill="#7f99b5"/>
          <line x1="264" y1="84" x2="264" y2="122" stroke="#7f99b5" stroke-width="1.8"/>
          <polygon points="264,122 259,112 269,112" fill="#7f99b5"/>
          <line x1="140" y1="246" x2="182" y2="182" stroke="#7f99b5" stroke-width="1.8"/>
          <polygon points="182,182 173,187 181,193" fill="#7f99b5"/>
          <line x1="346" y1="162" x2="388" y2="162" stroke="#7f99b5" stroke-width="1.8"/>
          <polygon points="388,162 378,157 378,167" fill="#7f99b5"/>
          <line x1="346" y1="188" x2="388" y2="246" stroke="#7f99b5" stroke-width="1.8"/>
          <polygon points="388,246 379,241 381,251" fill="#7f99b5"/>
        </svg>
      </div>
    </div>

    <div class="card" style="margin-top:12px;">
      <h3>受け入れ判定チェック（抜粋）</h3>
      <table class="table">
        <thead><tr><th>No</th><th>観点</th><th>合格条件</th></tr></thead>
        <tbody>
          <tr><td>1</td><td>一回提出制御</td><td>同一社員・同一月の2回目提出が `409` で拒否される</td></tr>
          <tr><td>2</td><td>プルダウン統一</td><td>入力時の社員候補が `employees` マスタ由来で表示される</td></tr>
          <tr><td>3</td><td>同期</td><td>提出/更新時にDB差分をCSVに反映する</td></tr>
          <tr><td>4</td><td>管理機能</td><td>未提出一覧と同期履歴が管理画面で確認できる</td></tr>
        </tbody>
      </table>
    </div>
    <div class="footer"><span>Shift Aggregation Visual Spec</span><span>3 / 3</span></div>
  </section>
</body>
</html>

